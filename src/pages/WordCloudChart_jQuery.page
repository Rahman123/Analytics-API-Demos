<apex:page showHeader="false" sidebar="false">


<link rel="stylesheet" type="text/css" href="http://visapi-gadgets.googlecode.com/svn/trunk/termcloud/tc.css"/>
<apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"/>

<apex:includeScript value="https://visapi-gadgets.googlecode.com/svn/trunk/termcloud/tc.js"/>
<apex:includeScript value="https://www.google.com/jsapi" />


<script type = "text/javascript">

	google.load("visualization", "1");
	google.setOnLoadCallback(draw);


	function draw() {
	 // Fetch the JSON data representing the report
      var jsonData = JSON.parse($.ajax({
          beforeSend: function(xhr) {
            xhr.setRequestHeader('Authorization', 'Bearer {!$Api.Session_ID}');
          },
          url: "/services/data/v29.0/analytics/reports/{!$CurrentPage.parameters.id}",
          dataType:"json",
          async: false
          }).responseText);


       	var dataArray = [];


	// get data from json (uses ISO country codes - generated by Country Picklist)
    $.each(jsonData.groupingsDown.groupings, function (indKey, indValue) {
      	var value = []
      	value.push(indValue.value, jsonData.factMap[indValue.key+"!T"].aggregates[0].value);
      	dataArray.push(value);
      	console.log(value)

    });

      	data = new google.visualization.DataTable();
        data.addColumn('string', 'Label');
        data.addColumn('number', 'Value');
        //data.addColumn('string', 'Link');
        data.addRows(dataArray);

    	console.log(dataArray);

		var outputDiv = document.getElementById('tcdiv');
        var tc = new TermCloud(outputDiv);
        tc.draw(data, null);

	}

</script>
	
	<!--some bad html! -->
	<center>
		<br/><br/>
			<font size="8">Who are our customers?</font>
			<br/><br/><br/>
		<div id="tcdiv" style="width: 500px; height: 500px;"></div>
	</center>
	
</apex:page>